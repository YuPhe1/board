<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{component/config :: config}"></th:block>
</head>
<body>
<div th:replace="~{component/header :: header}"></div>
<div th:replace="~{component/nav :: nav}"></div>
<div class="container my-3">
    <div class="card p-3">
        <div class="card-title" th:text="${board.boardTitle}"></div>
        <div class="row">
            <div class="col-6">
                <div class="card-subtitle mb-2 text-body-secondary"
                     th:text="|작성자:${board.boardWriter}|"></div>
            </div>
            <div class="col-6 text-end">
                <div class="card-subtitle mb-2 text-body-secondary"
                     th:text="|작성자: ${board.boardHits} 작성일: ${board.createdAt}|"></div>
            </div>
        </div>
        <hr>
        <div class="card-text mb-3" th:text="${board.boardContents}"></div>
        <div class="text-center mb-3">
            <button class="btn btn-primary" onclick="req_fn('update')">수정</button>
            <button class="btn btn-secondary" onclick="toList()">목록</button>
            <button class="btn btn-danger" onclick="req_fn('delete')">삭제</button>
        </div>
        <div id="check-pass-area"></div>
    </div>
</div>
<div th:replace="~{component/footer :: footer}"></div>
</body>
<script th:inline="javascript">
    const checkPassArea = document.querySelector("#check-pass-area");
    const id = [[${board.id}]]
    const passDB = [[${board.boardPass}]];
    const toList = () => {
        const page = [[${page}]];
        const type = [[${type}]];
        const q = [[${q}]];
        location.href = `/board?page=${page}&type=${type}&q=${q}`;
    };
    const req_fn = (type) => {
        let area = "<div class='input-group mb-2'><span class='input-group-text'>비밀번호</span>"
        area += "<input id='pass' type='password' class='form-control'></div>"
        area += `<div class="text-end"><button class="btn btn-secondary" onclick="pass_check('${type}')">확인</button></div>`
        checkPassArea.innerHTML = area;
    };
    const pass_check = (type) => {
        console.log("type: " + type);
        const pass = document.querySelector("#pass").value;
        if (pass == passDB) {
            if(type == "update"){
                location.href = `/board/update/${id}`;
            } else if (type == "delete") {
                axios({
                    method: "delete",
                    url: `/board/${id}`
                }).then(res => {
                    location.href = "/board"
                }).catch(err => {
                    alert("삭제실패");
                });
            }
        } else {
            alert("비밀번호가 틀렸습니다.");
        }
    }
</script>
</html>